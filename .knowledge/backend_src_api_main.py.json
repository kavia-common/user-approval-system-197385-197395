{"is_source_file": true, "format": "Python", "description": "A FastAPI backend service implementation for the Tic Tac Toe game, providing health check and game state persistence endpoints, with database initialization and schema management.", "external_files": ["os", "sqlite3", "datetime", "fastapi", "pydantic"], "external_methods": ["FastAPI", "HTTPException", "CORSMiddleware", "BaseModel", "Field", "datetime.now", "os.getenv", "os.path.exists", "sqlite3.connect"], "published": ["health_check", "save_game_state", "get_latest_game_state", "db_diagnostics"], "classes": [{"name": "GameStateIn", "description": "Model for incoming Tic Tac Toe game state data, representing the state sent from the frontend."}, {"name": "GameStateOut", "description": "Model for persisted game state data, including database ID and timestamp info."}], "methods": [{"name": "str _utc_now_iso()", "description": "Returns the current UTC time as an ISO formatted string.", "scope": "", "scopeKind": ""}, {"name": "str _get_db_path()", "description": "Resolves the SQLite database file path, defaulting to 'myapp.db' or overridden via environment variable.", "scope": "", "scopeKind": ""}, {"name": "sqlite3.Connection _get_conn()", "description": "Creates and returns a SQLite connection with row factory enabled.", "scope": "", "scopeKind": ""}, {"name": "None _init_db()", "description": "Initializes the database schema, creating the necessary tables if they do not exist.", "scope": "", "scopeKind": ""}, {"name": "str _encode_board(board: List[Optional[str]])", "description": "Encodes a Tic Tac Toe board list into a compact 9-character string.", "scope": "", "scopeKind": ""}, {"name": "List[Optional[Literal[\"X\",\"O\"]]] _decode_board(s: str)", "description": "Decodes a compact 9-character string back into a board list.", "scope": "", "scopeKind": ""}, {"name": "dict[str,Any] db_diagnostics()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "GameStateOut get_latest_game_state()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "dict health_check()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "GameStateOut save_game_state(payload: GameStateIn)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["os.getenv", "os.path.exists", "sqlite3.connect", "conn.cursor", "cur.execute", "conn.commit", "cur.lastrowid", "conn.close", "datetime.now", "row.fetchone", "row['board']", "row['next_player']", "row['winner']", "row['is_draw']", "row['moves']"], "search-terms": ["FastAPI", "TicTacToe", "SQLite-backed", "game state persistence", "health check", "board encoding", "game save", "latest game retrieval", "database initialization"], "state": 2, "file_id": 3, "knowledge_revision": 10, "git_revision": "d124ad72086ee271e6bfa44de4e7332778e596fd", "revision_history": [{"8": "9ca3440a5c1bacd110586dd9411b1a0516bdb9be"}, {"10": "d124ad72086ee271e6bfa44de4e7332778e596fd"}], "ctags": [{"_type": "tag", "name": "GameStateIn", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^class GameStateIn(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "GameStateOut", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^class GameStateOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_decode_board", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^def _decode_board(s: str) -> List[Optional[Literal[\"X\", \"O\"]]]:$/", "language": "Python", "typeref": "typename:List[Optional[Literal[\"X\",\"O\"]]]", "kind": "function", "signature": "(s: str)"}, {"_type": "tag", "name": "_encode_board", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^def _encode_board(board: List[Optional[str]]) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(board: List[Optional[str]])"}, {"_type": "tag", "name": "_get_conn", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^def _get_conn() -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_get_db_path", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^def _get_db_path() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_init_db", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^def _init_db() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_utc_now_iso", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^def _utc_now_iso() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "allowed_origins", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^allowed_origins = [\"*\"] if allowed_origins_raw.strip() == \"*\" else [o.strip() for o in allowed_o/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "allowed_origins_raw", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^allowed_origins_raw = os.getenv(\"ALLOWED_ORIGINS\", \"*\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "board", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    board: List[Optional[Literal[\"X\", \"O\"]]] = Field(..., description=\"Board values as 9-element/", "language": "Python", "typeref": "typename:List[Optional[Literal[\"X\", \"O\"]]]", "kind": "variable", "scope": "GameStateIn", "scopeKind": "class"}, {"_type": "tag", "name": "board", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    board: List[Optional[Literal[\"X\", \"O\"]]] = Field(..., description=\"Board values as 9-element/", "language": "Python", "typeref": "typename:List[Optional[Literal[\"X\", \"O\"]]]", "kind": "variable", "scope": "GameStateOut", "scopeKind": "class"}, {"_type": "tag", "name": "created_at", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    created_at: str = Field(..., description=\"ISO timestamp (UTC) when record was created.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "GameStateOut", "scopeKind": "class"}, {"_type": "tag", "name": "db_diagnostics", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^def db_diagnostics() -> dict[str, Any]:$/", "language": "Python", "typeref": "typename:dict[str,Any]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_latest_game_state", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^def get_latest_game_state() -> GameStateOut:$/", "language": "Python", "typeref": "typename:GameStateOut", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^def health_check() -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    id: int = Field(..., description=\"Database id for this saved game state.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "GameStateOut", "scopeKind": "class"}, {"_type": "tag", "name": "is_draw", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    is_draw: bool = Field(False, description=\"Whether the game ended in a draw.\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "GameStateIn", "scopeKind": "class"}, {"_type": "tag", "name": "is_draw", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    is_draw: bool = Field(False, description=\"Whether the game ended in a draw.\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "GameStateOut", "scopeKind": "class"}, {"_type": "tag", "name": "moves", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    moves: int = Field(0, ge=0, le=9, description=\"Number of moves made.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "GameStateIn", "scopeKind": "class"}, {"_type": "tag", "name": "moves", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    moves: int = Field(0, ge=0, le=9, description=\"Number of moves made.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "GameStateOut", "scopeKind": "class"}, {"_type": "tag", "name": "next_player", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    next_player: Literal[\"X\", \"O\"] = Field(..., description=\"Player who should play next.\")$/", "language": "Python", "typeref": "typename:Literal[\"X\", \"O\"]", "kind": "variable", "scope": "GameStateIn", "scopeKind": "class"}, {"_type": "tag", "name": "next_player", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    next_player: Literal[\"X\", \"O\"] = Field(..., description=\"Player who should play next.\")$/", "language": "Python", "typeref": "typename:Literal[\"X\", \"O\"]", "kind": "variable", "scope": "GameStateOut", "scopeKind": "class"}, {"_type": "tag", "name": "openapi_tags", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^openapi_tags = [$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "save_game_state", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^def save_game_state(payload: GameStateIn) -> GameStateOut:$/", "language": "Python", "typeref": "typename:GameStateOut", "kind": "function", "signature": "(payload: GameStateIn)"}, {"_type": "tag", "name": "updated_at", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    updated_at: str = Field(..., description=\"ISO timestamp (UTC) when record was last updated.\"/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "GameStateOut", "scopeKind": "class"}, {"_type": "tag", "name": "winner", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    winner: Optional[Literal[\"X\", \"O\"]] = Field(None, description=\"Winner if game is finished.\")$/", "language": "Python", "typeref": "typename:Optional[Literal[\"X\", \"O\"]]", "kind": "variable", "scope": "GameStateIn", "scopeKind": "class"}, {"_type": "tag", "name": "winner", "path": "/home/kavia/workspace/code-generation/user-approval-system-197385-197395/backend/src/api/main.py", "pattern": "/^    winner: Optional[Literal[\"X\", \"O\"]] = Field(None, description=\"Winner if game is finished.\")$/", "language": "Python", "typeref": "typename:Optional[Literal[\"X\", \"O\"]]", "kind": "variable", "scope": "GameStateOut", "scopeKind": "class"}], "hash": "d18f7a6458e45b43f10d084bf5b1923a", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/api/main.py", "fields": [{"name": "allowed_origins = [\"*\"] if allowed_origins_raw.strip() == \"*\" else [o.strip() for o in allowed_o/", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "allowed_origins_raw = os.getenv(\"ALLOWED_ORIGINS\", \"*\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[Optional[Literal[\"X\", \"O\"]]] board", "scope": "GameStateIn", "scopeKind": "class", "description": "unavailable"}, {"name": "str created_at", "scope": "GameStateOut", "scopeKind": "class", "description": "unavailable"}, {"name": "int id", "scope": "GameStateOut", "scopeKind": "class", "description": "unavailable"}, {"name": "bool is_draw", "scope": "GameStateIn", "scopeKind": "class", "description": "unavailable"}, {"name": "int moves", "scope": "GameStateIn", "scopeKind": "class", "description": "unavailable"}, {"name": "Literal[\"X\", \"O\"] next_player", "scope": "GameStateIn", "scopeKind": "class", "description": "unavailable"}, {"name": "openapi_tags = [", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str updated_at", "scope": "GameStateOut", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[Literal[\"X\", \"O\"]] winner", "scope": "GameStateIn", "scopeKind": "class", "description": "unavailable"}]}